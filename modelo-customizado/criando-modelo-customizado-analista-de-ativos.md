
Vamos montar **passo a passo** um **modelo personalizado** para **an√°lise fundamentalista de ativos (a√ß√µes, FIIs, stocks)**, que interpreta indicadores como P/L, ROE, DY, P/VP, crescimento, endividamento e outros, e responde de forma estruturada se o ativo √© de ‚Äúqualidade‚Äù ou n√£o.

---

# üß† Objetivo

Criar um modelo local (via **Ollama**) que:

* Recebe o nome ou dados de um ativo (ex: PETR4, AAPL, HGLG11);
* Analisa **fundamentos** (indicadores quantitativos e qualitativos);
* Classifica o ativo como **‚Äúbom‚Äù, ‚Äúneutro‚Äù ou ‚Äúruim‚Äù**;
* Justifica a decis√£o em linguagem natural e formato t√©cnico (Markdown ou JSON).

---

## üß© 1. Conceito do modelo

O modelo ser√° **derivado de um modelo base**, como `mistral`, `llama3` ou `gemma`.
Usaremos um **Modelfile** para definir:

* Persona: analista fundamentalista;
* Estilo: t√©cnico, estruturado, sem linguagem emocional;
* Par√¢metros: temperatura baixa (para consist√™ncia anal√≠tica);
* Template: estrutura de sa√≠da padronizada (Markdown ou JSON).

---

## ‚öôÔ∏è 2. Exemplo completo de **Modelfile**

Salve como `Modelfile`:

```bash
# Modelfile: analista-fundamentalista
FROM llama3

SYSTEM """
Voc√™ √© um analista fundamentalista de investimentos. 
Sua fun√ß√£o √© avaliar empresas, fundos imobili√°rios e a√ß√µes com base em seus fundamentos e indicadores.
Use dados quantitativos e qualitativos sempre que dispon√≠veis, e adote uma linguagem t√©cnica e objetiva.

Regras:
- Explique o racioc√≠nio de forma estruturada.
- Classifique o ativo em uma das categorias: "Alta qualidade", "Neutro" ou "Baixa qualidade".
- Baseie-se em m√©tricas como P/L, P/VP, ROE, margem l√≠quida, d√≠vida l√≠quida/EBITDA, payout, crescimento e setor.
- Seja imparcial e nunca d√™ recomenda√ß√µes de compra/venda ‚Äî apenas an√°lise.
- Se n√£o houver dados suficientes, diga isso claramente.
"""

PARAMETER temperature 0.4
PARAMETER top_p 0.9
PARAMETER num_predict 512

TEMPLATE """
Ativo: {{ .Prompt }}

Responda com a seguinte estrutura:

**Resumo do Ativo**
- Nome / Ticker:
- Setor:
- Breve descri√ß√£o:

**Indicadores Fundamentais**
- P/L:
- P/VP:
- ROE:
- Dividend Yield:
- Margem L√≠quida:
- Crescimento de Lucros:
- D√≠vida L√≠quida / EBITDA:
- Outros relevantes:

**An√°lise Qualitativa**
- Pontos fortes:
- Pontos fracos:
- Considera√ß√µes sobre o setor:

**Classifica√ß√£o Final**
- Qualidade: Alta | Neutra | Baixa
- Justificativa resumida:
"""
```

---

## üöÄ 3. Criando o modelo

No terminal do Ubuntu (WSL):

```bash
ollama create analista-fundamentalista -f Modelfile
```

E para rodar:

```bash
ollama run analista-fundamentalista
```

Teste com prompts como:

```
PETR4
```

ou

```
HGLG11
```

ou ainda:

```
AAPL ‚Äî analise fundamentalista
```

---

## üßÆ 4. Exemplos de intera√ß√£o

### Exemplo 1

**Prompt:**

```
PETR4
```

**Resposta esperada:**

```
**Resumo do Ativo**
- Nome / Ticker: Petrobras (PETR4)
- Setor: Petr√≥leo e G√°s
- Breve descri√ß√£o: Estatal brasileira de energia e explora√ß√£o de petr√≥leo.

**Indicadores Fundamentais**
- P/L: 4,5
- P/VP: 1,1
- ROE: 27%
- Dividend Yield: 18%
- Margem L√≠quida: 25%
- D√≠vida L√≠quida / EBITDA: 1,2x

**An√°lise Qualitativa**
- Pontos fortes: alta gera√ß√£o de caixa, margens robustas.
- Pontos fracos: risco pol√≠tico e volatilidade de pre√ßos do petr√≥leo.

**Classifica√ß√£o Final**
- Qualidade: Alta
- Justificativa: indicadores de rentabilidade fortes, endividamento controlado e m√∫ltiplos atrativos, apesar do risco pol√≠tico.
```

---

## üß† 5. Melhoria com **formato JSON**

Se voc√™ quiser integrar esse modelo com automa√ß√µes (ex: Python, Node, ou dashboard),
mude o `TEMPLATE` para gerar **JSON estruturado**:

```bash
TEMPLATE """
Ativo: {{ .Prompt }}

Responda SOMENTE no formato JSON, seguindo o modelo abaixo:

{
  "ticker": "",
  "setor": "",
  "indicadores": {
    "pl": "",
    "pvp": "",
    "roe": "",
    "dy": "",
    "margem_liquida": "",
    "divida_ebitda": "",
    "crescimento": ""
  },
  "analise": {
    "pontos_fortes": [],
    "pontos_fracos": [],
    "classificacao": "Alta | Neutra | Baixa",
    "justificativa": ""
  }
}
"""
```

üí° Assim, o output pode ser consumido facilmente por automa√ß√µes ou sistemas que fazem ranking de ativos.

---

## üìà 6. Tornando o modelo ‚Äúfundamentado em dados reais‚Äù

O Ollama n√£o tem acesso direto √† internet (por padr√£o),
mas voc√™ pode integr√°-lo com scripts externos que buscam os dados e os passam no prompt.

### Exemplo via Python:

```python
import requests
import subprocess
import json

def get_dados_acao(ticker):
    url = f"https://api.example.com/acoes/{ticker}"  # pode ser StatusInvest, AlphaVantage, Yahoo Finance etc.
    return requests.get(url).json()

def analisar_ativo(ticker):
    dados = get_dados_acao(ticker)
    prompt = f"{ticker} - {dados}"
    resultado = subprocess.run(["ollama", "run", "analista-fundamentalista"], input=prompt, text=True, capture_output=True)
    return resultado.stdout

print(analisar_ativo("PETR4"))
```

---

## üß± 7. Boas pr√°ticas

‚úÖ **Temperatura baixa (0.3‚Äì0.5):** respostas mais objetivas e consistentes.
‚úÖ **Templates padronizados:** facilita automa√ß√£o.
‚úÖ **Use SYSTEM para papel fixo:** evita ‚Äúdrift‚Äù de personalidade.
‚úÖ **Integre com APIs externas:** fornece dados reais de indicadores.
‚úÖ **Evite recomenda√ß√µes expl√≠citas de compra/venda.**

---

## üß© 8. Extens√µes poss√≠veis

* Adicionar suporte a **fundos imobili√°rios (FIIs)** e **a√ß√µes estrangeiras (stocks)**;
* Inserir classifica√ß√£o ESG (Ambiental, Social, Governan√ßa);
* Integrar com **base de dados local (SQLite ou CSV)**;
* Criar varia√ß√£o do modelo para **an√°lise t√©cnica** (gr√°ficos e tend√™ncias);
* Criar **pipeline com Open WebUI** para dashboards financeiros.

---

## üèÅ 9. Conclus√£o

Esse tipo de modelo √© ideal para:

* **Pain√©is internos** de research;
* **Automa√ß√£o de relat√≥rios financeiros**;
* **Chatbots anal√≠ticos** em Open WebUI ou Telegram;
* **Estudos educacionais** sobre fundamentos de ativos.

> üí¨ ‚ÄúO diferencial n√£o est√° em treinar um novo modelo, mas em ensinar um modelo existente a pensar como um analista.‚Äù
















--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------
- Dia 18/10/2025

Perfeito, Fernando üí™
Vamos montar **dois setups completos**:

1Ô∏è‚É£ **Gemma 2 9B** ‚Äî modelo geral, excelente para racioc√≠nio anal√≠tico e linguagem natural (ideal para uso di√°rio e an√°lise textual).
2Ô∏è‚É£ **FinGPT** ‚Äî modelo especializado em finan√ßas, ajustado com vocabul√°rio e l√≥gica financeira.

Voc√™ poder√° rodar ambos no **Ollama** dentro do **WSL** (Ubuntu 22), alternando conforme a necessidade.

---

# ‚öôÔ∏è 1. Instala√ß√£o e configura√ß√£o do Ollama (se ainda n√£o estiver)

> Pule este passo se j√° tiver o Ollama instalado.

```bash
curl -fsSL https://ollama.com/install.sh | sh
```

Depois:

```bash
ollama --version
```

Se aparecer algo como `ollama version 0.3.x`, est√° pronto.

---

# üß† 2. Instala√ß√£o do **Gemma 2 9B**

A Google lan√ßou o **Gemma 2 9B** com excelente custo/benef√≠cio ‚Äî leve, racioc√≠nio t√©cnico e suporte multil√≠ngue.

### ‚úÖ Passos:

```bash
ollama pull gemma2:9b
```

Espere o download (~5 GB).

Teste o modelo:

```bash
ollama run gemma2:9b
```

---

## üß© Crie o modelo customizado ‚ÄúAnalista Fundamentalista ‚Äì Gemma‚Äù

Crie o arquivo:

```bash
nano Modelfile
```

Cole:

```bash
# Modelfile: analista-fundamentalista-gemma
FROM gemma2:9b

SYSTEM """
Voc√™ √© um analista fundamentalista de investimentos.
Analise a√ß√µes, FIIs e stocks com base em fundamentos econ√¥micos e financeiros.
Avalie m√∫ltiplos como P/L, P/VP, ROE, DY, endividamento e crescimento.
Classifique o ativo como 'Alta qualidade', 'Neutra' ou 'Baixa qualidade'.
N√£o fa√ßa recomenda√ß√µes de compra/venda.
"""

PARAMETER temperature 0.4
PARAMETER top_p 0.9
PARAMETER num_predict 512

TEMPLATE """
Ativo: {{ .Prompt }}

Responda com a estrutura:

**Resumo do Ativo**
**Indicadores Fundamentais**
**An√°lise Qualitativa**
**Classifica√ß√£o Final**
"""
```

Salve e crie o modelo:

```bash
ollama create analista-fundamentalista-gemma -f Modelfile
```

Execute:

```bash
ollama run analista-fundamentalista-gemma
```

Teste:

```
PETR4
```

ou

```
HGLG11
```

---

# üíº 3. Instala√ß√£o e uso do **FinGPT**

O **FinGPT** √© um modelo **finetuned** em relat√≥rios, not√≠cias e balan√ßos financeiros.
Ele n√£o est√° no reposit√≥rio oficial do Ollama, ent√£o voc√™ precisar√° **baixar a vers√£o compat√≠vel em `.gguf`** e import√°-la.

---

## üß© A) Baixando o modelo (via Hugging Face)

Acesse o Hugging Face e busque o reposit√≥rio:

üîó [https://huggingface.co/FinGPT](https://huggingface.co/FinGPT)
ou
üîó [https://huggingface.co/FinanceAI/finma-7b](https://huggingface.co/FinanceAI/finma-7b)

Baixe o arquivo `.gguf` (ex: `fingpt-mistral-7b.Q4_K_M.gguf`) ‚Äî ele costuma ter de 4 a 8 GB.

Copie para o diret√≥rio do Ollama:

```bash
sudo mkdir -p /usr/share/ollama/models
sudo cp fingpt-mistral-7b.Q4_K_M.gguf /usr/share/ollama/models/
```

---

## üß© B) Criando o modelo no Ollama

Crie o arquivo:

```bash
nano Modelfile
```

Cole:

```bash
# Modelfile: analista-fundamentalista-fingpt
FROM ./fingpt-mistral-7b.Q4_K_M.gguf

SYSTEM """
Voc√™ √© um analista financeiro especializado em an√°lise fundamentalista.
Sua tarefa √© avaliar empresas e fundos com base em seus fundamentos e m√∫ltiplos.
Use terminologia financeira correta e linguagem t√©cnica.
Responda de forma estruturada e objetiva.
"""

PARAMETER temperature 0.3
PARAMETER top_p 0.85
PARAMETER num_predict 600

TEMPLATE """
Analisar o ativo: {{ .Prompt }}

Responda no formato:

{
  "ticker": "",
  "setor": "",
  "indicadores": {
    "pl": "",
    "pvp": "",
    "roe": "",
    "dy": "",
    "endividamento": ""
  },
  "analise": {
    "pontos_fortes": [],
    "pontos_fracos": [],
    "qualidade": "Alta | Neutra | Baixa"
  }
}
"""
```

Salve e crie o modelo:

```bash
ollama create analista-fundamentalista-fingpt -f Modelfile
```

Teste:

```bash
ollama run analista-fundamentalista-fingpt
```

Prompt:

```
AAPL ‚Äî fundamentos e qualidade do ativo
```

---

# üß© 4. Comparando os dois modelos

| Crit√©rio                  | **Gemma 2 9B**                 | **FinGPT (7B)**                   |
| ------------------------- | ------------------------------ | --------------------------------- |
| Dom√≠nio de finan√ßas       | M√©dio (generalista)            | Alto (especializado)              |
| Linguagem natural (PT/EN) | Excelente                      | Boa (treino mais em ingl√™s)       |
| Contexto anal√≠tico        | √ìtimo                          | Excelente em fundamentos          |
| Tamanho                   | ~5 GB                          | 4‚Äì8 GB                            |
| Requisitos de hardware    | CPU i7 / 16 GB RAM m√≠n.        | CPU ou GPU leve                   |
| Melhor uso                | Relat√≥rios, an√°lises completas | Dashboards e automa√ß√£o financeira |

üí° **Dica:**
Use o **Gemma 2 9B** para relat√≥rios explicativos e
o **FinGPT** para an√°lises r√°pidas e estruturadas (via JSON).

---

# üîó 5. Integra√ß√£o com APIs (dados reais)

Voc√™ pode unir esses modelos a dados reais via Python:

```python
import requests, subprocess, json

ticker = "PETR4"
dados = requests.get(f"https://brapi.dev/api/quote/{ticker}").json()

prompt = f"Analise fundamentalista do ativo {ticker} com base nesses dados:\n{json.dumps(dados, indent=2)}"

result = subprocess.run(
    ["ollama", "run", "analista-fundamentalista-gemma"],
    input=prompt,
    text=True,
    capture_output=True
)

print(result.stdout)
```

Assim, o modelo analisa **dados reais atualizados**.

---

# üß± 6. Boas pr√°ticas

‚úÖ Prefira `temperature 0.3‚Äì0.5` para consist√™ncia;
‚úÖ Teste prompts curtos (‚ÄúPETR4 fundamentos‚Äù) e longos (‚ÄúAnalise PETR4 com foco em ROE e d√≠vida l√≠quida‚Äù);
‚úÖ Mantenha logs dos resultados para validar coer√™ncia;
‚úÖ Documente suas varia√ß√µes de Modelfile (v1, v2, etc).

---

# üèÅ 7. Resumo final

| Cen√°rio                                   | Modelo ideal         | Comando                                      |
| ----------------------------------------- | -------------------- | -------------------------------------------- |
| An√°lises explicativas e linguagem natural | **Gemma 2 9B**       | `ollama run analista-fundamentalista-gemma`  |
| An√°lises estruturadas com JSON            | **FinGPT (Mistral)** | `ollama run analista-fundamentalista-fingpt` |

---

Se quiser, posso gerar **os dois Modelfiles prontos + script Python completo** (com API da Brapi para dados de a√ß√µes brasileiras) ‚Äî formatado como um mini-projeto para rodar direto no WSL.
Quer que eu monte esse pacote para voc√™ (com arquivos `.Modelfile`, `.py` e exemplo de sa√≠da)?




> ollama ls
NAME                  ID              SIZE      MODIFIED
deepseek-r1:70b       d37b54d01a76    42 GB     4 weeks ago
deepseek-r1:latest    6995872bfe4c    5.2 GB    6 weeks ago
> ollama pull gemma2:9b
pulling manifest
pulling ff1d1fc78170:  27% ‚ñï‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà                                           ‚ñè 1.5 GB/5.4 GB   14 MB/s   4m34s


ollama pull gemma2:9b





> cd /home/fernando/cursos/ia-inteligencia-artificial/kodekloud-running-local-llms-with-ollama/modelo-customizado
> ollama create analista-fundamentalista-gemma -f Modelfile
gathering model components
using existing layer sha256:ff1d1fc78170d787ee1201778e2dd65ea211654ca5fb7d69b5a2e7b123a50373
using existing layer sha256:097a36493f718248845233af1d3fefe7a303f864fae13bc31a3a9704229378ca
creating new layer sha256:87cd0771a511c1b2f2fb949937f06ecb6c33b5f2d8364285f476a34e9fafa52e
creating new layer sha256:846f6ee8cf2c24d89e566964df738b9f28202cd5bfa6cec1f0cc92d88a39f441
creating new layer sha256:619e1959902b73a513da9f715b9740056499aa57e5f75b5a87f419726aa0dced
writing manifest
success




- Resultado fraco:
N√ÉO TRAZ INDICADORES, NEM DE EXEMPLO
DADOS GEN√âRICOS DEMAIS.


> ollama run analista-fundamentalista-gemma
>>> PETR4
**Riscos e Oportunidades**

##  PETR4 - Petrobras (Petr√≥leo Brasileiro S.A.)

**Resumo do Ativo:**

Petrobras √© a maior empresa brasileira de petr√≥leo e g√°s natural, com opera√ß√µes em explora√ß√£o, produ√ß√£o, refino,
transporte, comercializa√ß√£o e distribui√ß√£o de combust√≠veis. A empresa possui ativos em diversos pa√≠ses, incluindo
Brasil, Estados Unidos, Argentina, Chile, Peru e Angola.

**Indicadores Fundamentais:**

* **ROE (Retorno sobre o Patrim√¥nio L√≠quido):**  - Em an√°lise constante devido √† volatilidade do setor.
* **ROA (Retorno sobre Ativos):** - Em an√°lise constante devido √† volatilidade do setor.
* **P/L (Pre√ßo por Lucro):** - Em an√°lise constante devido √† volatilidade do setor.
* **Dividendo:** Petrobras tem hist√≥rico de pagamento de dividendos, mas a pol√≠tica pode variar com os resultados
e cen√°rio econ√¥mico.

**An√°lise Qualitativa:**

* **Vantagens:**
    * Posi√ß√£o dominante no mercado brasileiro de petr√≥leo e g√°s natural.
    * Ampla rede de infraestrutura log√≠stica.
    * Diversidade geogr√°fica de opera√ß√µes.
    * Investimentos em energias renov√°veis.
* **Desvantagens:**
    * Vulnerabilidade a flutua√ß√µes nos pre√ßos do petr√≥leo.
    * Regulamenta√ß√£o governamental complexa e pol√≠tica.
    * Altos custos operacionais.
    * Hist√≥rico de esc√¢ndalos de corrup√ß√£o.

**Classifica√ß√£o Final:**

A classifica√ß√£o final depende da toler√¢ncia ao risco do investidor e da an√°lise individual dos indicadores e
fatores mencionados acima.

**Riscos e Oportunidades:**

* **Riscos:**
    * Flutua√ß√µes nos pre√ßos do petr√≥leo.
    * Mudan√ßas na pol√≠tica energ√©tica brasileira.
    * Concorr√™ncia acirrada no mercado global de petr√≥leo.
    * Desastres naturais e eventos geopol√≠ticos.
* **Oportunidades:**
    * Crescimento da demanda por energia em pa√≠ses emergentes.
    * Investimentos em tecnologias de produ√ß√£o mais eficientes.
    * Expans√£o para novos mercados internacionais.
    * Transi√ß√£o para energias renov√°veis.



**Observa√ß√µes:**

Esta an√°lise √© apenas um guia inicial e n√£o deve ser considerada como aconselhamento financeiro profissional. √â
importante realizar pesquisas adicionais e consultar um consultor financeiro antes de tomar

>>> Send a message (/? for help)






Feito! Montei um **mini-projeto completo** com scraping da Status Invest (Playwright + fallback requests/bs4) e integra√ß√£o com seu **modelo no Ollama**.

**Download:** [statusinvest_toolkit.zip](sandbox:/mnt/data/statusinvest_toolkit.zip)

### O que vem no pacote

* `statusinvest_scrape.py` ‚Äî scraper **Playwright** (renderiza JS, recomendado).
* `statusinvest_requests.py` ‚Äî fallback com **requests + BeautifulSoup**.
* `run_analise.py` ‚Äî roda o scraper e passa os dados para seu modelo no **Ollama**.
* `Modelfile.gemma` ‚Äî Modelfile para `gemma2:9b` (analista em Markdown).
* `Modelfile.fingpt` ‚Äî Modelfile para `.gguf` (FinGPT/Mistral) com sa√≠da **JSON**.
* `requirements.txt`, `Makefile`, `README.md`.

### Como usar (resumo)

```bash
# 1) Preparar ambiente
make install

# 2) (Opcional) Criar modelo Gemma
ollama pull gemma2:9b
ollama create analista-fundamentalista-gemma -f Modelfile.gemma

# 3) Scraping (Playwright)
make scrape TICKER=BBAS3

# 4) Analisar com seu modelo
make analise TICKER=BBAS3 MODEL=analista-fundamentalista-gemma
```

Se quiser, ajusto os **r√≥tulos** espec√≠ficos para FIIs (vac√¢ncia, P/VP, DY 12m, etc.) e adiciono um target `make scrape-fii TICKER=HGLG11`.
